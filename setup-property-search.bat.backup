@echo off
REM Laravel React Property Search Setup Script
REM This script sets up the enhanced property search with Ampre API integration

echo 🏠 Setting up Laravel React Property Search with Ampre API...

REM Check if we're in the right directory
if not exist "artisan" (
    echo ❌ Error: Please run this script from the Laravel project root directory
    exit /b 1
)

echo 📦 Installing/updating dependencies...

REM Install PHP dependencies
call composer install --no-dev --optimize-autoloader

REM Install and build frontend assets  
call npm install
call npm run build

echo 🔧 Setting up configuration...

REM Create .env file if it doesn't exist
if not exist ".env" (
    copy .env.example .env
    echo ✅ Created .env file from .env.example
)

REM Generate application key if not set
call php artisan key:generate

echo 🗄️ Setting up database...

REM Run migrations
call php artisan migrate --force

REM Seed database if needed
call php artisan db:seed --force

echo 🧹 Clearing caches...

REM Clear various caches
call php artisan config:clear
call php artisan route:clear
call php artisan view:clear
call php artisan cache:clear

echo 🔗 Creating storage link...
call php artisan storage:link

echo 📝 Setting up Ampre API configuration...

echo.
echo ⚙️  AMPRE API CONFIGURATION
echo ================================
echo To complete the setup, please add these variables to your .env file:
echo.
echo # Ampre API Configuration
echo AMPRE_API_URL=https://query.ampre.ca/odata/
echo AMPRE_VOW_TOKEN=your_vow_token_here
echo AMPRE_IDX_TOKEN=your_idx_token_here
echo AMPRE_CACHE_TTL=300
echo.
echo # Optional: Google Maps Integration
echo GOOGLE_MAPS_API_KEY=your_google_maps_api_key_here
echo.
echo # Optional: WalkScore Integration
echo WALKSCORE_API_KEY=your_walkscore_api_key_here
echo.

echo 🧪 Testing API configuration...

REM Test basic Laravel setup
call php artisan config:cache
call php artisan route:cache

echo.
echo ✅ Setup complete!
echo.
echo 🚀 NEXT STEPS:
echo 1. Add your Ampre API credentials to the .env file
echo 2. Test the API connection: GET /api/ampre/test/config
echo 3. Test property search: GET /api/ampre/test/properties
echo 4. Visit /search to see the new property search page
echo.
echo 📋 AVAILABLE TEST ENDPOINTS:
echo • GET /api/ampre/test/config - Test API configuration
echo • GET /api/ampre/test/properties - Test property fetching
echo • GET /api/ampre/test/properties-with-count - Test with count
echo • GET /api/ampre/test/price-range - Test price filtering
echo • GET /api/ampre/test/or-filters - Test OR filtering
echo • GET /search - New enhanced search page
echo • GET /api/properties/search - AJAX search endpoint
echo.
echo 🎯 FEATURES IMPLEMENTED:
echo • ✅ Real-time property search with Ampre API
echo • ✅ Advanced filtering (price, beds, baths, location)
echo • ✅ Multiple view types (Grid, List, Mixed with Map)
echo • ✅ Property images from Ampre API
echo • ✅ Pagination and sorting
echo • ✅ Responsive design
echo • ✅ Property count display
echo • ✅ Error handling and loading states
echo.
echo 🗺️  MAP INTEGRATION:
echo The map view is ready for Google Maps integration.
echo Add your Google Maps API key to enable interactive maps.
echo.

REM Check if server might be running (basic check)
echo ⚠️  Start the development server with: php artisan serve
echo 🌐 Then visit http://localhost:8000/search to test the property search

echo.
echo 📞 Need help? Check the documentation or test the API endpoints above.

pause
